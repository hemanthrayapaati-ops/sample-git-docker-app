---
# âœ… Define pipeline steps (modern syntax)
steps:
  build_and_push:
    image: docker:latest
    privileged: true            # âœ… allows Docker-in-Docker, avoids "insufficient privileges"
    commands:
      - echo "ðŸš€ Building Docker image..."
      - docker build --no-cache -t hemanthr2002/sample-app:latest .
      - echo "$${DOCKER_PASSWORD}" | docker login -u "$${DOCKER_USERNAME}" --password-stdin
      - docker push hemanthr2002/sample-app:latest
    when:
      event: [push, manual]     # âœ… fixes "Please set an event filter" warning

  redeploy:
    image: docker:latest
    privileged: true            # âœ… same fix for this step
    commands:
      - echo "ðŸ”„ Redeploying latest Docker image..."
      - docker pull hemanthr2002/sample-app:latest
      - docker rm -f sample-app || true
      - docker run -d -p 8080:80 --name sample-app hemanthr2002/sample-app:latest
    when:
      event: [push, manual]     # âœ… ensures step runs only on push or manual trigger
